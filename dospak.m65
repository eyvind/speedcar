10 CATALOG JSR CLOSE7
20       LDX #$70
30       LDA # <DIRNAME
40       STA ICBADR,X
50       LDA # >DIRNAME
60       STA ICBADR+1,X
70       LDA #5
80       STA ICBLEN,X
90       LDA #0
0100     STA ICBLEN+1,X
0110     LDA #6
0120     STA ICAUX1,X
0130     LDA #3
0140     STA ICCOM,X
0150     JSR CIO
0160     BMI CLOSE7
0170     LDA #0
0180     STA XPTR
0190 REDIR LDX XPTR
0200     LDA $64
0210     STA SLOT,X
0220     LDA $65
0230     STA SLOT+1,X
0240     INC XPTR
0250     INC XPTR
0260     JSR GET7
0270     BMI CLOSE7
0280     CMP #'*+1
0290     BCS ENDIR
0300     JSR CHROUT
0310     JSR GET7
0320     BMI CLOSE7
0330     LDA #0
0340     STA DIRCOUNT
0350 DIRLOOP JSR GET7
0360     BMI CLOSE7
0370 DNOTCR JSR CHROUT
0380     INC DIRCOUNT
0390     LDA DIRCOUNT
0400     CMP #8
0410     BNE DNOT8
0420     LDA #'.
0430     JSR CHROUT
0440     JMP DIRLOOP
0450 DNOT8 CMP #11
0460     BNE DIRLOOP
0470     LDA #5
0480     STA TEMP
0490 THROW5 JSR GET7
0500     DEC TEMP
0510     LDA TEMP
0520     BNE THROW5
0530     JMP REDIR
0540 CLOSE7 LDX #$70
0550     LDA #12
0560     STA ICCOM,X
0570     JSR CIO
0580     LDX #$70
0590     LDY ICSTAT,X
0600     RTS 
0610 ENDIR PHA 
0620     LDA #155
0630     JSR CHROUT
0640     PLA 
0650     JSR CHROUT
0660 ENDLP JSR GET7
0670     BMI CLOSE7
0680     JSR CHROUT
0690     JMP ENDLP
0700 GET7 LDX #$70
0710     LDA #0
0720     STA ICBLEN,X
0730     STA ICBLEN+1,X
0740     LDA #7
0750     STA ICCOM,X
0760     JMP CIO
0770 DOS JSR DELITE
0780     JSR OPENEDITOR
0790     JSR DELITE
0800     LDA #1
0810     STA 752
0820     STA 82
0830     LDA #125
0840     JSR CHROUT
0850     JSR CATALOG
0860     JSR DOSMSG
0870 GETNAME LDA SLOT
0880     STA SCR
0890     LDA SLOT+1
0900     STA SCR+1
0910     LDA #0
0920     STA XSLOT
0930     DEC XPTR
0940     DEC XPTR
0950 NAMELP JSR INVNAME
0960     JSR GETAKEY
0970     LDX #1
0980     STX 752
0990     LDX DOSTABLE
1000     CMP #97
1010     BCC NOPROB
1020     AND #95
1030 NOPROB STA TEMP
1040 FINDIT CMP DOSTABLE,X
1050     BEQ FOUNDIT
1060     DEX 
1070     BNE FINDIT
1080     JMP JNAME
1090 FOUNDIT DEX 
1100     TXA 
1110     ASL A
1120     TAX 
1130     LDA DOSADR+1,X
1140     PHA 
1150     LDA DOSADR,X
1160     PHA 
1170     RTS 
1180 DOSTABLE .BYTE 15
1190     .BYTE "RLUF1234"
1200 DOSADR .WORD DLEFT-1,DRIGHT-1,DUP-1,DDOWN-1,DELFILE-1,RENAME-1
1210     .WORD LOCK-1,UNLOCK-1,FORMAT-1,DRIVE-1,DRIVE-1,DRIVE-1
1220     .WORD DRIVE-1,ESCDOS-1,LOADIT-1
1230 DLEFT JSR INVNAME
1240     LDX XSLOT
1250     BEQ NRANGE
1260     DEX 
1270     DEX 
1280     JMP RESLOT
1290 DRIGHT JSR INVNAME
1300     LDX XSLOT
1310     INX 
1320     INX 
1330     CPX XPTR
1340     BCS NRANGE
1350 RESLOT STX XSLOT
1360     LDA SLOT,X
1370     STA SCR
1380     LDA SLOT+1,X
1390     STA SCR+1
1400 NRANGE JMP NAMELP
1410 DUP JSR INVNAME
1420     LDA XSLOT
1430     CMP #6
1440     BCC NRANGE
1450     SEC 
1460     SBC #6
1470     TAX 
1480     JMP RESLOT
1490 DDOWN JSR INVNAME
1500     LDA XSLOT
1710     CLC 
1720     ADC #6
1730     CMP XPTR
1740     BCS NRANGE
1750     TAX 
1760     JMP RESLOT
1770 NAMER LDX #0
1780 COPYD LDA DIRNAME,X
1790     STA FNBUFF,X
1800     INX 
1810     CPX #3
1820     BNE COPYD
1830     LDY #1
1840 COPYNAME LDA (SCR),Y
1850     AND #127
1860     JSR INTOAS
1870     CMP #32
1880     BEQ NOSTOR
1890     STA FNBUFF,X
1900     INX 
1910 NOSTOR INY 
1920     CPY #13
1930     BNE COPYNAME
1940     LDA FNBUFF-1,X
1950     CMP #'.
1960     BNE NOTDOT
1970     DEX 
1980 NOTDOT STX FNLEN
1990     LDA #0
2000     STA FNBUFF,X
2010     RTS 
2020 XIO LDX #$70
2030     STA ICCOM,X
2040     LDA FNLEN
2050     STA ICBLEN,X
2060     LDA #0
2070     STA ICBLEN+1,X
2080     LDA # <FNBUFF
2090     STA ICBADR,X
2100     LDA # >FNBUFF
2110     STA ICBADR+1,X
2120     JMP CIO
2130 DELFILE JSR NAMER
2140     LDA #33
2150 GOXIO JSR XIO
2160     BPL JNAME
2170     JMP DOSERR
2180 JNAME JSR INVNAME
2190     JMP NAMELP
2200 LOCK JSR NAMER
2210     LDA #35
2220     JMP GOXIO
2230 UNLOCK JSR NAMER
2240     LDA #36
2250     JMP GOXIO
2260 RENAME JSR BOTCLR
2270     LDA # <RENMSG
2280     LDY # >RENMSG
2290     JSR PRMSG
2300     LDA #64
2310     STA $02BE
2320     JSR INPUT
2330     LDA #0
2340     STA $02BE
2350     LDA INLEN
2360     BEQ NONAME
2370     JSR NAMER
2380     LDX #0
2390     LDY FNLEN
2400     LDA #',
2410     STA FNBUFF,Y
2420     INY 
2430 COPYR LDA INBUFF,X
2440     STA FNBUFF,Y
2450     INY 
2460     INX 
2470     CPX INLEN
2480     BNE COPYR
2490     STY FNLEN
2500     LDA #0
2510     STA FNBUFF,Y
2520     JSR DOSMSG
2530     LDA #32
2540     JMP GOXIO
2550 NONAME JSR DOSMSG
2560     JMP JNAME
2570 FORMAT JSR BOTCLR
2580     LDA # <FORMSG
2590     LDY # >FORMSG
2600     JSR PRMSG
2610     JSR YORN
2620     BNE NONAME
2630     JSR DOSMSG
2640     JSR NAMER
2650     LDA #254
2660     JMP GOXIO
2670 DRIVE LDA TEMP
2680     STA DIRNAME+1
2690     JMP DOS
2700 LOADIT LDX #$70
2710     STX IOCB
2720     LDA #4
2730     STA ICAUX1,X
2740     LDA #0
2750     STA INDIR
2760     STA INDIR+1
2770     JSR NAMER
2780     LDA #3
2790     JSR XIO
2800     BMI DOSERR
2810     JSR ERASE
2820     JSR LOADLINK
2830     BMI DOSERR
2840 ESCDOS LDX #$FA
2850     TXS 
2860     LDA #125
2870     JSR CHROUT
2880     JSR HIGHLIGHT
2890     JSR SYSMSG
2900     JMP MAIN
2910 BOTCLR LDA #22
2920     STA 84
2930     LDA #157
2940     JSR CHROUT
2950     JMP CHROUT
2960 DOSERR STY YSAVE
2970     JSR CLOSE7
2980     JSR BOTCLR
2990     LDA # <ERRMSG
3000     LDY # >ERRMSG
3010     JSR PRMSG
3020     LDX YSAVE
3030     LDA #0
3040     JSR OUTNUM
3050     LDA #253
3060     JSR CHROUT
3070     LDA # <DIRMSG
3080     LDY # >DIRMSG
3090     JSR PRMSG
3100     JSR GETAKEY
3110     JSR DOSMSG
3120     JMP JNAME
3130 INVNAME LDY #12
3140 INVLP LDA (SCR),Y
3150     EOR #128
3160     STA (SCR),Y
3170     DEY 
3180     BPL INVLP
3190     RTS 
3200 DOSMSG JSR BOTCLR
3210     LDA # <DIRINS
3220     LDY # >DIRINS
3230     JSR PRMSG
3240     LDA DIRNAME+1
3250     JMP CHROUT
3260     .END 
